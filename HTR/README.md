# ML Training and Transcription to Caesar

This directory assumes that you've run the volunteer transcriptions through the [aggregation_for_caesar](https://aggregation-caesar.zooniverse.org/Scripts.html) repo. The files used in the scripts as inputs won't make sense otherwise.

## Files

Below is a detailed description of each file in this directory. Make sure the file paths in each script are fixed in order for the scripts to run.

### `commands_preprocessing.sh`

Contains the shell commands that are necassary to completly process the data. Simply uncomment the commands to fully process the data received from the output of `aggregation_for_caesar`.

    > Line 13 is not necassary and is kept there seperately because it is to process the data without rotating images. If this doesn't ring a bell, do not uncomment line 13.

### `lines_analysis.py`

This code generates Box labels from lines by using the distance between lines in a letter. Using that distance distribution, each line is matched to a line above it with a height scalar that is sampled from the distance distribution. The tails of the distance distribution are removed to make sure boxes are not too big too small.

### `add_location_to_all_boxes`

This code simply adds the hard disk location of the image files into the output file generated from lines_analysis

### `create_diagonal_box_dataset.py`

This code takes all images and boxes, then rotates the images by a specific angle `angle_rotate` that is between -10 and 10 degrees that serves as augmentation to the line detector model. Since the images are rotated, the corresponding labels must also be rotated.

### `convert_angular_labels_to_coco.py`

This code simply converts the csv into three splits and converts the three label splits into jsons. This could possibly be converted into two scripts.

### `split_train_test_per_json.py`

Using the 3 jsons from `convert_angular_labels_to_coco.py`, this script moves the actual images into specific directories.

### `add_image_height_width_to_json.py`

After running the above pipeline, the detector model required the height and width of images to be present in the data. This step could be skipped if the detector model is not used.

### `crop_transcription_from_boxes.py`

We want our transcription model to have the same splits in order for the models to not have performance leaks. Using the json files from the files above, we crop images using the box labels and save them to specific train, val and test directories. Keep in mind the box labels can also be labels generated by inference by the detector model. Since converting angular boxes to axis aligned boxes, some non-trivial warping using a mask clone was created that is around 70% accurate with validation tests and buggy 50% of the time of the remaining 30%.

### `create_lstm_dataset_given_cropped_images_and_labels.py`

If you've got here then you're almost done! This code generates the file blobs for the transcription model using the json files created by `crop_transcription_from_boxes.py`.

### `all_boxes_with_locations_to_non_rotated_train_test_val.py`

given jsons and box locations you can use this script to create the transcription dataset without any rotations. Not required to run, but helpful to have.

### `diagonal_box.py`

Contains code that visualizes and shows how to rotate an image and its corresponding boxes.

### `fill_cropped_image_text.py`

This code loads the transcription model and fills in the text prediction for each cropped image.

### `filter_predictions_using_training.py`

Using the text and box information of the test data and the training data used, this script generates statistics that help in removing bad predictions. The current ways of filtering predictions are the following:

1. The detector model contains a box_score -> a threshold is set

2. Using a bivariate gaussian distribution that is fit on the training data using the aspect ratio and length of the text as the two variables, each test prediction is given a pdf score using that distribution -> a pdf threshold is set

3. sentence character entropy. Using the character entropy from the training set (which follows a normal distribution) -> a threshold is set

4. text line slope -> a threshold is set

### `convert_predictions_to_extracts.py`

Using feedback from zooniverse members, this code converts the result from `fill_cropped_image_text.py` into a json that contains all necassary information for the file extract csv.

### `link_extracts_to_subjects.py`

Using the json from `convert_predictions_to_extracts.py` and an image id (from the detection model) to a corresponding subject id json, a file extract csv is generated, using the guidance of Zooniverse members.

## Input/Output files views

### `detections.json`

    ```
    {
        "annotations": [
            {
                "image_id": 0,
                "score": 0.77197265625,
                "category_id": 0,
                "bbox": [
                    473.95867919921875,
                    3585.424072265625,
                    1923.6426391601562,
                    472.5517578125,
                    0.03555812861145784
                ],
                "segmentation": [
                    [
                        482.9483355670792,
                        3551.3975275418256,
                        466.18437070874154,
                        4022.6512063373198,
                        2387.6116619915147,
                        4091.0023748019244,
                        2404.3756268498523,
                        3619.7486960064302
                    ]
                ]
            },
            ...
        ],
        "images": [
            {
                "id": 0,
                "file_name": "95ed9273-b134-4395-ae15-78bfa6264dd3.jpeg"
            },
            ...
        ]
    }
    ```

### `detections_cropped.json`

    ```
    [
        {
        "im_path": "/home/fortson/alnah005/aggregation_for_caesar/htr/../../text_recognition/data/umnDatasetSample_cropped/9689653f-c634-4af4-9f58-31c7ecab05e9_rotated_test_0.jpeg",
        "im_id": 2,
        "bbox": [
            961.819580078125,
            264.5279235839844,
            180.6942138671875,
            764.9997863769531,
            1.4946386860621161
        ],
        "text": null,
        "crop_h": 220,
        "crop_w": 804,
        "area": 176880,
        "box_score": 0.513671875
        },
        ...
    ]
    ```

### `detections_cropped_with_text.json`

    ```
    [
        {
        "im_path": "/home/fortson/alnah005/aggregation_for_caesar/htr/../../text_recognition/data/umnDatasetSample_cropped/9689653f-c634-4af4-9f58-31c7ecab05e9_rotated_test_0.jpeg",
        "im_id": 2,
        "bbox": [
            961.819580078125,
            264.5279235839844,
            180.6942138671875,
            764.9997863769531,
            1.4946386860621161
        ],
        "text": "lettary the tom - arkgecat thunder",
        "crop_h": 220,
        "crop_w": 804,
        "area": 176880,
        "box_score": 0.513671875
        },
        ...
    ]
    ```

### `detections_cropped_with_text_stats_filled.json`

    ```
    [
        {
        "im_path": "/home/fortson/alnah005/aggregation_for_caesar/htr/../../text_recognition/data/umnDatasetSample_cropped/9689653f-c634-4af4-9f58-31c7ecab05e9_rotated_test_0.jpeg",
        "im_id": 2,
        "bbox": [
            961.819580078125,
            264.5279235839844,
            180.6942138671875,
            764.9997863769531,
            1.4946386860621161
        ],
        "text": "lettary the tom - arkgecat thunder",
        "crop_h": 220,
        "crop_w": 804,
        "area": 176880,
        "box_score": 0.513671875,
        "crop_w_div_h": 3.6545454545454548,
        "text_len": 29,
        "gaussian_fit_score": 0.0012543576216027415,
        "sentence_avg_entropy": 0.15814197568239502,
        "x": [
            677,
            1440
        ],
        "y": [
            766,
            708
        ],
        "slope": -0.07601572739187404,
        "slope_deg": -4.347020291775478
        },
        ...
    ]
    ```

### `detections_cropped_with_text_stats_filled_extracts.json`

    ```
    {
        "2": {
            "frame0": {
                "text": [
                    [
                        "lettary the tom - arkgecat thunder"
                    ]
                ],
            "slope": [
                -4.347020291775478
            ],
            "points": {
            "x": [
                [
                  677,
                  1440
               ]
            ],
            "y": [
               [
                  766,
                  708
               ]
            ]
            },
            "gold_standard": false,
            "file_name": "9689653f-c634-4af4-9f58-31c7ecab05e9_rotated_test.jpeg"
      },
      ...
   },
    ```

### `final_extracts.csv`

|extractor_key|subject_id|data     |
|-------------|----------|---------|
|alice        |136232    |{"frame0": {"text": [["lettary the tom - arkgecat thunder"]], "slope": [-4.347020291775478], "points": {"x": [[677, 1440]], "y": [[766, 708]]}, "gold_standard": false, "file_name": "9689653f-c634-4af4-9f58-31c7ecab05e9_rotated_test.jpeg"}}|
|alice        |136238    |{"frame0": {"text": [["e o o"]], "slope": [-9.059291576982682], "points": {"x": [[322, 1476]], "y": [[2090, 1906]]}, "gold_standard": false, "file_name": "f6c71717-aaea-43e2-bd90-621af45459c8_rotated_val.jpeg"}}|
|alice        |136235    |{"frame0": {"text": [["pi a a a a a ing"]], "slope": [-173.7089423073739], "points": {"x": [[1297, 145]], "y": [[2099, 1972]]}, "gold_standard": false, "file_name": "e0eac7c8-0087-4b39-8736-76220e54c53e_rotated_val.jpeg"}}|
|alice        |136231    |{"frame0": {"text": [["dome of it - should we make any shupmento to"], ["yoo o pe o to o e ]"], ["e e e e e e o o e te eo"], ["of tho wo w wo wo wo wo wo wo for"], ["[ o o boo bo bo o ofet"], ["I e o o o o o o"]], "slope": [-177.25949762193767, -178.02859459755166, -178.63096128032754, -177.30347591891393, -177.5007282418089, -1.1530730533033067], "points": {"x": [[2417, 307], [2534, 297], [2416, 282], [2400, 298], [2048, 513], [361, 2398]], "y": [[1653, 1552], [2644, 2567], [2359, 2308], [1517, 1418], [905, 838], [606, 565]]}, "gold_standard": false, "file_name": "294cae59-58a0-4af0-b374-777395dc4ebc.jpeg"}}|

### `imageid_to_subjectid.json`

    ```
    {
        "0": {
            "file_name": "95ed9273-b134-4395-ae15-78bfa6264dd3.jpeg",
            "subject_id": "136229"
        },
        ...
    }
    ```

### `all_boxes.csv`

|subjectId_frame_classification|x_0     |y_0      |x_1             |y_1              |height           |x_2              |y_2               |x_3               |y_3              |text                                                |
|------------------------------|--------|---------|----------------|-----------------|-----------------|-----------------|------------------|------------------|-----------------|----------------------------------------------------|
|63430539_0_0                  |566.0819091796875|684.4194946289062|2431.87255859375|700.48046875     |383.0744987936581|569.3793432590967|301.35918794795515|2435.1699926731594|317.4201620690489|"Quite suddenly--it may be at the turning of a lane,|
|63430539_0_1                  |548.5200805664062|776.6829223632812|2431.83203125   |802.6114501953125|102.1309814453125|549.9260372708495|674.5616187252646 |2433.2379879544433|700.4901465572958|Where I stand to watch a skylark soar from out      |

### `all_lines.csv`

|subjectId_frame_classification|x_0     |y_0      |x_1             |y_1              |consensus_text   |
|------------------------------|--------|---------|----------------|-----------------|-----------------|
|63430539_0_0                  |566.0819091796875|684.4194946289062|2431.87255859375|700.48046875     |"Quite suddenly--it may be at the turning of a lane,|
|63430539_0_1                  |548.5200805664062|776.6829223632812|2431.83203125   |802.6114501953125|Where I stand to watch a skylark soar from out|

### `poly_line_text_reducer_htr.csv`

|subject_id|workflow_id                  |task  |reducer                                      |data.frame0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |data.low_consensus_lines|data.transcribed_lines|data.reducer          |data.aggregation_version|data.parameters.eps_slope|data.parameters.eps_line|data.parameters.eps_word|data.parameters.gutter_tol|data.parameters.min_word_count|data.parameters.dot_freq|data.parameters.min_samples|data.parameters.low_consensus_threshold|data.parameters.minimum_views|data.parameters.process_by_line|
|----------|-----------------------------|------|---------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------|----------------------|----------------------|------------------------|-------------------------|------------------------|------------------------|--------------------------|------------------------------|------------------------|---------------------------|---------------------------------------|-----------------------------|-------------------------------|
|63430539  |18227                        |T0    |poly_line_text_reducer                       |[{'clusters_x': [566.0819091796875, 2431.87255859375], 'clusters_y': [684.4194946289062, 700.48046875], 'clusters_text': [['"Quite'], ['suddenly--it'], ['may'], ['be'], ['at'], ['the'], ['turning'], ['of'], ['a'], ['lane,']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': '"Quite suddenly--it may be at the turning of a lane,', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [0], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [548.5200805664062, 2431.83203125], 'clusters_y': [776.6829223632812, 802.6114501953125], 'clusters_text': [['Where'], ['I'], ['stand'], ['to'], ['watch'], ['a'], ['skylark'], ['soar'], ['from'], ['out']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'Where I stand to watch a skylark soar from out', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [1], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [652.6096801757812, 1414.181640625], 'clusters_y': [891.2252197265625, 905.0634155273438], 'clusters_text': [['the'], ['swelling'], ['grain.']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'the swelling grain.', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [2], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [565.3276977539062, 2474.33642578125], 'clusters_y': [987.8958740234375, 997.905029296875], 'clusters_text': [['That'], ['the'], ['trump'], ['of'], ['God'], ['shall'], ['thrill'], ['me,'], ['with'], ['its'], ['call']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'That the trump of God shall thrill me, with its call', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [3], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [650.8974609375, 1317.015625], 'clusters_y': [1086.04931640625, 1095.5863037109375], 'clusters_text': [['so'], ['loud'], ['and'], ['clear.']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'so loud and clear.', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [4], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [600.526611328125, 2436.3603515625], 'clusters_y': [1179.73193359375, 1205.8111572265625], 'clusters_text': [['And'], ["I'm"], ['called'], ['away'], ['to'], ['meet'], ['Him,'], ['Whom'], ['of'], ['all']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': "And I'm called away to meet Him, Whom of all", 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [5], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [654.7445068359375, 1350.4375], 'clusters_y': [1287.94677734375, 1291.4295654296875], 'clusters_text': [['I'], ['hold'], ['most'], ['dear.']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'I hold most dear.', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [6], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [579.0963134765625, 2317.1312255859375], 'clusters_y': [1382.8179931640625, 1379.530517578125], 'clusters_text': [['Quite'], ['suddenly--it'], ['may'], ['be'], ['in'], ['His'], ['house'], ['I'], ['bend']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'Quite suddenly--it may be in His house I bend', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [7], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [699.5274658203125, 1058.94677734375], 'clusters_y': [1481.281494140625, 1486.167236328125], 'clusters_text': [['my'], ['knee,']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'my knee,', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [9], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [657.0880126953125, 2454.618408203125], 'clusters_y': [1570.56884765625, 1578.92431640625], 'clusters_text': [['When'], ['the'], ['kingly'], ['voice,'], ['long'], ['hoped'], ['for,'], ['comes']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'When the kingly voice, long hoped for, comes', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [8], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [700.800537109375, 1658.252685546875], 'clusters_y': [1681.452392578125, 1670.0723876953125], 'clusters_text': [['at'], ['last'], ['to'], ['summon'], ['me,']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'at last to summon me,', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [11], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [595.353759765625, 2442.563232421875], 'clusters_y': [1768.443115234375, 1777.700439453125], 'clusters_text': [['And'], ['the'], ['fellowship'], ['of'], ['earth-life'], ['that'], ['has'], ['seemed']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'And the fellowship of earth-life that has seemed', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [10], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [674.2330932617188, 1479.6024169921875], 'clusters_y': [1869.7529296875, 1870.108642578125], 'clusters_text': [['so'], ['passing'], ['sweet,']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'so passing sweet,', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [12], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [668.0348510742188, 2471.796875], 'clusters_y': [1965.6160888671875, 1965.5751953125], 'clusters_text': [['Proves'], ['nothing'], ['but'], ['the'], ['shadow'], ['of'], ['our'], ['meet-']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'Proves nothing but the shadow of our meet-', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [13], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [708.02392578125, 1612.4556884765625], 'clusters_y': [2072.174560546875, 2063.544921875], 'clusters_text': [['ing'], ['round'], ['His'], ['feet.']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'ing round His feet.', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [14], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [556.64892578125, 2480.39794921875], 'clusters_y': [2165.34326171875, 2183.49658203125], 'clusters_text': [['Quite'], ['suddenly--it'], ['may'], ['be'], ['as'], ['I'], ['tread'], ['the'], ['busy'], ['street,']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'Quite suddenly--it may be as I tread the busy street,', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [15], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [634.1848754882812, 2414.48779296875], 'clusters_y': [2254.43701171875, 2277.1416015625], 'clusters_text': [['Strong'], ['to'], ['endure'], ["life's"], ['stress'], ['and'], ['strain,'], ['its']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': "Strong to endure life's stress and strain, its", 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [16], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [692.478271484375, 1518.884521484375], 'clusters_y': [2361.817626953125, 2372.48291015625], 'clusters_text': [['every'], ['call'], ['to'], ['meet,']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'every call to meet,', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [17], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [545.2897338867188, 2502.90087890625], 'clusters_y': [2467.284423828125, 2465.505615234375], 'clusters_text': [['That'], ['through'], ['the'], ['roar'], ['of'], ['traffic,'], ['a'], ['trumpet,'], ['silvery']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'That through the roar of traffic, a trumpet, silvery', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [18], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [687.646240234375, 877.0772705078125], 'clusters_y': [2557.1337890625, 2557.1337890625], 'clusters_text': [['clear,']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'clear,', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [19], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [638.5494995117188, 2413.9951171875], 'clusters_y': [2658.350830078125, 2659.58447265625], 'clusters_text': [['Shall'], ['stir'], ['my'], ['startled'], ['senses'], ['and'], ['proclaim']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'Shall stir my startled senses and proclaim', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [20], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [743.8059692382812, 1488.4423828125], 'clusters_y': [2763.0458984375, 2772.054443359375], 'clusters_text': [['His'], ['coming'], ['near.']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'His coming near.', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [21], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [549.8972778320312, 2506.439697265625], 'clusters_y': [2851.55419921875, 2861.6611328125], 'clusters_text': [['Quite'], ['suddenly--it'], ['may'], ['be'], ['as'], ['I'], ['life'], ['in'], ['dreamless'], ['sleep,']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'Quite suddenly--it may be as I life in dreamless sleep,', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [22], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [666.9764404296875, 2470.389892578125], 'clusters_y': [2962.218505859375, 2961.205322265625], 'clusters_text': [["God's"], ['gift'], ['to'], ['many'], ['a'], ['sorrowing'], ['heart,'], ['with'], ['no']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': "God's gift to many a sorrowing heart, with no", 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [23], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [703.756103515625, 2503.805419921875], 'clusters_y': [3057.005615234375, 3111.446044921875], 'clusters_text': [['more', ''], ['tears', 'ear;'], ['to', ''], ['weep', '']], 'number_views': 2, 'consensus_score': 1.0, 'consensus_text': 'more tears to weep', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False, False], 'extract_index': [24, 26], 'user_ids': [2326328, 2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [560.3760986328125, 2516.25341796875], 'clusters_y': [3161.9404296875, 3160.4306640625], 'clusters_text': [['That'], ['a'], ['call'], ['shall'], ['break'], ['my'], ['slumber'], ['and'], ['a'], ['voice'], ['sound'], ['in'], ['my']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'That a call shall break my slumber and a voice sound in my', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [25], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [661.0450439453125, 2487.093017578125], 'clusters_y': [3248.662841796875, 3253.789794921875], 'clusters_text': [['Rise'], ['up,'], ['my'], ['love,'], ['and'], ['come'], ['away,'], ['behold'], ['the'], ["Bridegroom's"]], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': "Rise up, my love, and come away, behold the Bridegroom's", 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [27], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [749.3216552734375, 867.417236328125], 'clusters_y': [3295.533203125, 3294.726806640625], 'clusters_text': [['here."']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'here."', 'line_slope': 0.90449518317086, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [28], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}]|28                      |28                    |poly_line_text_reducer|3.6.0                   |25.0                     |40.0                    |40.0                    |0.0                       |1                             |line                    |1                          |3                                      |5                            |False                          |
|63430543  |18227                        |T0    |poly_line_text_reducer                       |[{'clusters_x': [986.3873291015625, 1188.9239501953125], 'clusters_y': [272.42059326171875, 263.04144287109375], 'clusters_text': [['Grocer']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'Grocer', 'line_slope': -5.240351183623462, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [0], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [993.4993286132812, 1213.436767578125], 'clusters_y': [357.415283203125, 342.33917236328125], 'clusters_text': [['Butcher']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'Butcher', 'line_slope': -5.240351183623462, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [1], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [1048.9405517578125, 1178.8363037109375], 'clusters_y': [429.9661560058594, 430.35980224609375], 'clusters_text': [['Car']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': 'Car', 'line_slope': -5.240351183623462, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [2], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [1111.9898681640625, 1159.5264892578125], 'clusters_y': [726.5455932617188, 723.7542724609375], 'clusters_text': [['3']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': '3', 'line_slope': -5.240351183623462, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [7], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [1141.211669921875, 1272.9532470703125], 'clusters_y': [1226.154296875, 1206.117431640625], 'clusters_text': [['263']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': '263', 'line_slope': -5.240351183623462, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [17], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [1164.21875, 1282.0194091796875], 'clusters_y': [1283.6510009765625, 1270.0819091796875], 'clusters_text': [['155']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': '155', 'line_slope': -5.240351183623462, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [18], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [1144.9818115234375, 1301.4478759765625], 'clusters_y': [1377.0970458984375, 1372.3592529296875], 'clusters_text': [['108']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': '108', 'line_slope': -5.240351183623462, 'slope_label': 0, 'gutter_label': 0, 'gold_standard': [False], 'extract_index': [19], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [1353.0015869140625, 1474.7099609375], 'clusters_y': [255.06971740722656, 247.2672882080078], 'clusters_text': [['480']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': '480', 'line_slope': -5.240351183623462, 'slope_label': 0, 'gutter_label': 1, 'gold_standard': [False], 'extract_index': [3], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [1408.7275390625, 1505.322509765625], 'clusters_y': [324.4481506347656, 312.2510681152344], 'clusters_text': [['92']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': '92', 'line_slope': -5.240351183623462, 'slope_label': 0, 'gutter_label': 1, 'gold_standard': [False], 'extract_index': [4], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [1339.4185791015625, 1481.4862060546875], 'clusters_y': [390.5372009277344, 387.5299987792969], 'clusters_text': [['341']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': '341', 'line_slope': -5.240351183623462, 'slope_label': 0, 'gutter_label': 1, 'gold_standard': [False], 'extract_index': [5], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [1331.0084228515625, 1508.2113037109375], 'clusters_y': [498.9724426269531, 499.59722900390625], 'clusters_text': [['913']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': '913', 'line_slope': -5.240351183623462, 'slope_label': 0, 'gutter_label': 1, 'gold_standard': [False], 'extract_index': [6], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [1498.1171875, 1621.310546875], 'clusters_y': [726.6473388671875, 710.6539306640625], 'clusters_text': [['413']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': '413', 'line_slope': -5.240351183623462, 'slope_label': 0, 'gutter_label': 1, 'gold_standard': [False], 'extract_index': [8], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [1499.643310546875, 1582.65869140625], 'clusters_y': [782.3530883789062, 765.9927368164062], 'clusters_text': [['150']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': '150', 'line_slope': -5.240351183623462, 'slope_label': 0, 'gutter_label': 1, 'gold_standard': [False], 'extract_index': [9], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [1475.59375, 1618.472412109375], 'clusters_y': [847.8528442382812, 830.3230590820312], 'clusters_text': [['263']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': '263', 'line_slope': -5.240351183623462, 'slope_label': 0, 'gutter_label': 1, 'gold_standard': [False], 'extract_index': [10], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [1601.5325927734375, 1658.3040771484375], 'clusters_y': [905.2603149414062, 894.2276611328125], 'clusters_text': [['150']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': '150', 'line_slope': -5.240351183623462, 'slope_label': 0, 'gutter_label': 1, 'gold_standard': [False], 'extract_index': [11], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [1401.3463134765625, 1465.1474609375], 'clusters_y': [986.2605590820312, 976.221923828125], 'clusters_text': [['30']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': '30', 'line_slope': -5.240351183623462, 'slope_label': 0, 'gutter_label': 1, 'gold_standard': [False], 'extract_index': [12], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [1544.5128173828125, 1619.6480712890625], 'clusters_y': [1069.3831787109375, 1061.5186767578125], 'clusters_text': [['140']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': '140', 'line_slope': -5.240351183623462, 'slope_label': 0, 'gutter_label': 1, 'gold_standard': [False], 'extract_index': [13], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [1593.6131591796875, 1634.1787109375], 'clusters_y': [1114.5755615234375, 1110.647705078125], 'clusters_text': [['10']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': '10', 'line_slope': -5.240351183623462, 'slope_label': 0, 'gutter_label': 1, 'gold_standard': [False], 'extract_index': [14], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [1576.945068359375, 1650.4171142578125], 'clusters_y': [1170.878662109375, 1168.763916015625], 'clusters_text': [['25']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': '25', 'line_slope': -5.240351183623462, 'slope_label': 0, 'gutter_label': 1, 'gold_standard': [False], 'extract_index': [15], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}, {'clusters_x': [1518.055908203125, 1645.5640869140625], 'clusters_y': [1250.28564453125, 1233.3072509765625], 'clusters_text': [['185']], 'number_views': 1, 'consensus_score': 1.0, 'consensus_text': '185', 'line_slope': -5.240351183623462, 'slope_label': 0, 'gutter_label': 1, 'gold_standard': [False], 'extract_index': [16], 'user_ids': [2326328], 'low_consensus': True, 'flagged': True}]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |20                      |20                    |poly_line_text_reducer|3.6.0                   |25.0                     |40.0                    |40.0                    |0.0                       |1                             |line                    |1                          |3                                      |5                            |False                          |

### `final_annotations_10_train_cropped.json`

    ```
    [
        {
            "im_path": "/home/fortson/alnah005/aggregation_for_caesar/htr/../../text_recognition/data/ASM/Original_Images_cropped_for_transcription_train/d713a533-bab9-40b4-9332-1f76781e00b9_0.jpeg",
            "im_id": 3058,
            "bbox": [
                182.0,
                89.0,
                175.0,
                164.0,
                1.4123719309229714
            ],
            "text": "PS",
            "crop_h": 215,
            "crop_w": 204,
            "area": 43860,
            "box_score": null,
            "box_id": 55034
        },
        ...
    ]
    ```

## [More Info](https://docs.google.com/presentation/d/19nKvKGxuHr3tc9c2Q3EutTJTgW0Ab8dgyXtbk7_iBic/edit#slide=id.g1036476c17d_0_0)
